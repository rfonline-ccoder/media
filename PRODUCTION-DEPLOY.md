# üöÄ SwagMedia Production Deploy

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Ubuntu 22 Server

### üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Ubuntu 22.04 LTS —Å–µ—Ä–≤–µ—Ä
- Root –¥–æ—Å—Ç—É–ø
- –î–æ–º–µ–Ω `swagmedia.site` –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞
- –ú–∏–Ω–∏–º—É–º 2GB RAM –∏ 20GB –¥–∏—Å–∫–∞

### üéØ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –≤ /root/media
scp -r /path/to/project root@your-server-ip:/root/
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É:**
```bash
cd /root
chmod +x deploy-production.sh
./deploy-production.sh
```

### üîß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç Ubuntu 22
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Node.js 20 LTS
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Python 3.11
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç MySQL/MariaDB
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Nginx
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç UFW Firewall

#### PM2 Management:
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PM2 –≥–ª–æ–±–∞–ª—å–Ω–æ
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ PM2
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è backend –∏ frontend
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `swagmedia_prod`
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `swagmedia_user`
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∞–¥–º–∏–Ω –∞–∫–∫–∞—É–Ω—Ç (admin/admin123)

#### Nginx + SSL:
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç –¥–ª—è `swagmedia.site`
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç Let's Encrypt
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç CORS
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç security headers
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç gzip —Å–∂–∞—Ç–∏–µ
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç SSL —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```
/root/media/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ venv/              # Python virtual environment
‚îÇ   ‚îú‚îÄ‚îÄ server.py          # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models.py          # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt   # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ .env              # Backend –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ build/            # –°–æ–±—Ä–∞–Ω–Ω–æ–µ React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ src/              # React –∏—Å—Ö–æ–¥–Ω–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ package.json      # Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ .env              # Frontend –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ ecosystem.config.js   # PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏:

#### PM2 –∫–æ–º–∞–Ω–¥—ã:
```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 status

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
pm2 restart all

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
pm2 restart swagmedia-backend
pm2 restart swagmedia-frontend

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 monit
```

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
# Nginx
systemctl status nginx
systemctl restart nginx
systemctl reload nginx

# MySQL
systemctl status mariadb
systemctl restart mariadb

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tlnp | grep :80
netstat -tlnp | grep :443
netstat -tlnp | grep :3000
netstat -tlnp | grep :8001
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
# –ó–∞–ø—É—Å–∫ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã
/root/swagmedia-monitor.sh
```

#### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
# Backend –ª–æ–≥–∏
tail -f /var/log/pm2/swagmedia-backend.log

# Frontend –ª–æ–≥–∏  
tail -f /var/log/pm2/swagmedia-frontend.log

# Nginx –ª–æ–≥–∏
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
/root/swagmedia-update.sh

# –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ backend
cd /root/media/backend
source venv/bin/activate
pip install -r requirements.txt
pm2 restart swagmedia-backend

# –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ frontend
cd /root/media/frontend
yarn install
yarn build
pm2 restart swagmedia-frontend
```

### üîê SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:

#### –°—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:
```bash
certbot certificates
```

#### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```bash
certbot renew
systemctl reload nginx
```

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL:
```bash
mysql -u swagmedia_user -p swagmedia_prod
# –ü–∞—Ä–æ–ª—å: SwagMedia2024!Production
```

#### –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
mysqldump -u swagmedia_user -p swagmedia_prod > backup_$(date +%Y%m%d).sql
```

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞:
```bash
mysql -u swagmedia_user -p swagmedia_prod < backup_20240815.sql
```

### üåê –î–æ—Å—Ç—É–ø –∫ —Å–∞–π—Ç—É:

- **–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç:** https://swagmedia.site
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://swagmedia.site/api/docs
- **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:** https://swagmedia.site (–ª–æ–≥–∏–Ω: admin, –ø–∞—Ä–æ–ª—å: admin123)

### üÜò Troubleshooting:

#### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
nslookup swagmedia.site

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
certbot --nginx -d swagmedia.site --force-renewal
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å PM2:
```bash
# –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ PM2
pm2 kill
pm2 resurrect

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
pm2 delete all
pm2 start ecosystem.config.js
pm2 save
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ MySQL
systemctl status mariadb

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ MySQL
systemctl restart mariadb

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
mysql -u swagmedia_user -p -e "SELECT 1"
```

### üì± –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

–°–∞–π—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è:
- ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚úÖ –ü–ª–∞–Ω—à–µ—Ç—ã
- ‚úÖ –î–µ—Å–∫—Ç–æ–ø
- ‚úÖ PWA –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞:
1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DOMAIN` –≤ —Å–∫—Ä–∏–ø—Ç–µ
2. –û–±–Ω–æ–≤–∏—Ç–µ DNS –∑–∞–ø–∏—Å–∏
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤:
1. –ò–∑–º–µ–Ω–∏—Ç–µ `BACKEND_PORT` –∏ `FRONTEND_PORT`
2. –û–±–Ω–æ–≤–∏—Ç–µ UFW –ø—Ä–∞–≤–∏–ª–∞
3. –û–±–Ω–æ–≤–∏—Ç–µ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

#### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ PM2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 scale swagmedia-backend 4  # 4 –ø—Ä–æ—Ü–µ—Å—Å–∞ backend
pm2 scale swagmedia-frontend 2 # 2 –ø—Ä–æ—Ü–µ—Å—Å–∞ frontend
```

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –≤–∞—à SwagMedia —Å–∞–π—Ç –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º SSL, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ PM2.

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** admin@swagmedia.site